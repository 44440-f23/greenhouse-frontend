<!DOCTYPE html>
<html>
    <head>
        <script src="https://cdn.socket.io/4.6.0/socket.io.min.js" integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+" crossorigin="anonymous"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='settings.css') }}"/>
      </head>
    <body>
        <header>

          <nav class="navbar navbar-expand-lg bg-light">
            <div class="container-fluid">
              <a class="navbar-brand" href="#">Navbar</a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="{{ url_for('index') }}">Status</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('chart') }}">Chart</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('settings') }}">Settings</a>
                  </li>
                </ul>
              </div>
          </nav>
        </header>
        <h1>
            Greenhouse Setting
        </h1>
        <form>
        <div id="greenhouse1">
            <h2>
                Greenhouse 1
            </h2>
            <h3>Tempature</h3>
            <div id="greenhouse1temp">
              <label for="temp1Min" class="col-form-label"> Minimum Tempature</label>
              <input class="min" type="number" placeholder="Min" id="temp1Min"/>
              <label for="temp1Max" class="col-form-label"> Maximum Tempature</label>
              <input class="max" type="number" placeholder="Max" id="temp1Max"/>
            </div>
            <h3>Humitity</h3>
            <div id="greenhouse1hum">
              <label for="hum1Min" class="col-form-label">Minimum Humidity</label>
              <input class="min" type="number" placeholder="Min" id="hum1Min"/>
              <label for="hum1Max" class="col-form-label">Maximum Humidity</label>
              <input class="max" type="number" placeholder="Max" id="hum1Max"/>
            </div>
        </div>
        <div id="greenhouse2">
            <h2>
                Greenhouse 2
            </h2>
            <h3>Tempature</h3>
            <div id="greenhouse2temp">
              <label for="temp2Min" class="col-form-label"> Minimum Tempature</label>
              <input class="min" type="number" placeholder="Min" id="temp2Min"/>
              <label for="temp2Max" class="col-form-label"> Maximum Tempature</label>
              <input class="max" type="number" placeholder="Max" id="temp2Max"/>
            </div>
            <h3>Humitity</h3>
            <div id="greenhouse2hum">
              <label for="hum2Min" class="col-form-label">Minimum Humidity</label>
              <input class="min" type="number" placeholder="Min" id="hum2Min"/>
              <label for="hum2Max" class="col-form-label">Maximum Humidity</label>
              <input class="max" type="number" placeholder="Max" id="hum2Max"/>              </div>
        </div>
        <div id="greenhouse3">
            <h2>
                Greenhouse 3
            </h2>
            <h3>Tempature</h3>
            <div id="greenhouse3temp">
              <label for="temp3Min" class="col-form-label"> Minimum Tempature</label>
              <input class="min" type="number" placeholder="Min" id="temp3Min"/>
              <label for="temp3Max" class="col-form-label"> Maximum Tempature</label>
              <input class="max" type="number" placeholder="Max" id="temp3Max"/>
            </div>
            <h3>Humitity</h3>
            <div id="greenhouse3hum">
              <label for="hum3Min" class="col-form-label">Minimum Humidity</label>
              <input class="min" type="number" placeholder="Min" id="hum3Min"/>
              <label for="hum3Max" class="col-form-label">Maximum Humidity</label>
              <input class="max" type="number" placeholder="Max" id="hum3Max"/>
            </div>
        </div>
        <div id="greenhouse4">
            <h2>
                Greenhouse 4
            </h2>
            <h3>temp</h3>
            <div id="greenhouse4temp">
              <label for="temp4Min" class="col-form-label"> Minimum Tempature</label>
              <input class="min" type="number" placeholder="Min" id="temp4Min"/>
              <label for="temp4Max" class="col-form-label"> Maximum Tempature</label>
              <input class="max" type="number" placeholder="Max" id="temp4Max"/>
            </div>
            <h3>humitity</h3>
            <div id="greenhouse4hum">
              <label for="hum4Min" class="col-form-label">Minimum Humidity</label>
              <input class="min" type="number" placeholder="Min" id="hum4Min"/>
              <label for="hum4Max" class="col-form-label">Maximum Humidity</label>
              <input class="max" type="number" placeholder="Max" id="hum4Max"/>
            </div>
        </div>
        <div id="greenhouse5">
            <h2>
                Greenhouse 5
            </h2>
            <h3>temp</h3>
            <div id="greenhouse5temp">
              <label for="temp5Min" class="col-form-label"> Minimum Tempature</label>
              <input class="min" type="number" placeholder="Min" id="temp5Min"/>
              <label for="temp5Max" class="col-form-label"> Maximum Tempature</label>
              <input class="max" type="number" placeholder="Max" id="temp5Max"/>
            </div>
            <h3>humitity</h3>
            <div id="greenhouse5hum">
              <label for="hum5Min" class="col-form-label">Minimum Humidity</label>
              <input class="min" type="number" placeholder="Min" id="hum5Min"/>
              <label for="hum5Max" class="col-form-label">Maximum Humidity</label>
              <input class="max" type="number" placeholder="Max" id="hum5Max"/>
            </div>
        </div>
        <div id="greenhouse6">
            <h2>
                Greenhouse 6
            </h2>
            <h3>temp</h3>
            <div id="greenhouse6temp">
              <label for="temp6Min" class="col-form-label"> Minimum Tempature</label>
              <input class="min" type="number" placeholder="Min" id="temp6min"/>
              <label for="temp6Max" class="col-form-label"> Maximum Tempature</label>
              <input class="max" type="number" placeholder="Max" id="temp6max"/>
            </div>
            <h3>humitity</h3>
            <div id="greenhouse6hum">
              <label for="hum5Min" class="col-form-label">Minimum Humidity</label>
              <input class="min" type="number" placeholder="Min" id="hum6Min"/>
              <label for="hum6Max" class="col-form-label">Maximum Humidity</label>
              <input class="max" type="number" placeholder="Max" id="hum6Max"/>
            </div>
        </div>
        <div class="col-12">
            <button class="btn btn-primary" type="submit" onclick="submitForm(event)">Submit changes</button>
        </div>
        </form>
        
    <pre id="jsonDisplay"></pre> <!-- Element to display the JSON data -->

    <script>
      function submitForm(event) {
          event.preventDefault(); // Prevents the default form submission behavior

          const minInputs = document.querySelectorAll('.min');
          const maxInputs = document.querySelectorAll('.max');

          const numberOfGreenhouses = minInputs.length / 2; // Assuming each greenhouse has 2 sets of inputs (min and max)

          const greenhouseData = {};

          for (let i = 0; i < numberOfGreenhouses; i++) {
            const index = i * 2; // Adjust the index to capture the appropriate input elements

            const tempMinValue = minInputs[index].value.trim();
            const tempMaxValue = maxInputs[index].value.trim();
            const humidityMinValue = minInputs[index + 1].value.trim();
            const humidityMaxValue = maxInputs[index + 1].value.trim();

            const tempMin = tempMinValue !== '' ? parseFloat(tempMinValue) : null;
            const tempMax = tempMaxValue !== '' ? parseFloat(tempMaxValue) : null;
            const humidityMin = humidityMinValue !== '' ? parseFloat(humidityMinValue) : null;
            const humidityMax = humidityMaxValue !== '' ? parseFloat(humidityMaxValue) : null;

            // Validation: min should be less than max
            if ((tempMin !== null && tempMax !== null && tempMin >= tempMax) || (humidityMin !== null && humidityMax !== null && humidityMin >= humidityMax)){
              alert('Minimum values must be lower than Maximum values!');
              return; // Stop processing
            }
            const greenhouseNumber = i + 1;
            greenhouseData[greenhouseNumber] = {
                tempMax: tempMax,
                tempMin: tempMin,
                humidityMax: humidityMax,
                humidityMin: humidityMin
            };
          }
          const jsonData = JSON.stringify(greenhouseData, null, 2);

          const jsonDisplay = document.getElementById('jsonDisplay');
          jsonDisplay.textContent = jsonData;

          //sending the data to the server using fetch API
          fetch('/submit_form',{
            method: 'POST',
            headers: {
              'Content-Type' : 'application/json',
            },
            body: jsonData, //send that good json data
          })
          .then(response => {
            if (response.ok){
              console.log('data send successfully');
            }
            else{
              console.log('Error in sending data');
            }
          })
          .catch(error =>{
            console.error('Error: ', error);
          }) 
      }
  </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    </body>
    
</html>